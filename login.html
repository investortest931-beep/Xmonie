<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | XMONIE - Secure VTU Solutions</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020617; }
        .glass-card {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
    </style>
</head>
<body class="text-slate-100 min-h-screen flex flex-col selection:bg-green-500/30">

    <nav class="p-6">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <a href="index.html" class="flex items-center gap-2 text-2xl font-black text-white">
                <span class="bg-green-600 p-1.5 rounded-lg"><i data-lucide="coins" class="w-6 h-6"></i></span>
                XMONIE
            </a>
        </div>
    </nav>

    <main class="flex-grow flex items-center justify-center p-6">
        <div class="w-full max-w-md">
            <div class="glass-card p-10 rounded-[2.5rem] shadow-2xl relative overflow-hidden">
                <!-- Decoration -->
                <div class="absolute -top-24 -right-24 w-48 h-48 bg-green-600/10 rounded-full blur-3xl"></div>
                
                <div class="relative z-10">
                    <h1 class="text-3xl font-extrabold text-white mb-2">Welcome Back</h1>
                    <p class="text-slate-400 mb-8 font-medium">Please enter your details to login.</p>

                    <form id="loginForm" class="space-y-5">
                        <div>
                            <label class="block text-xs font-bold uppercase tracking-widest text-slate-500 mb-2 ml-1">Email Address</label>
                            <div class="relative">
                                <i data-lucide="mail" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500"></i>
                                <input type="email" name="email" required placeholder="name@example.com" 
                                    class="w-full bg-slate-950/50 border border-slate-800 rounded-2xl pl-12 pr-4 py-4 focus:border-green-500 outline-none transition text-white">
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between mb-2 ml-1">
                                <label class="text-xs font-bold uppercase tracking-widest text-slate-500">Password</label>
                                <a href="#" class="text-xs font-bold text-green-500 hover:text-green-400">Forgot?</a>
                            </div>
                            <div class="relative">
                                <i data-lucide="lock" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500"></i>
                                <input type="password" name="password" required placeholder="••••••••" 
                                    class="w-full bg-slate-950/50 border border-slate-800 rounded-2xl pl-12 pr-4 py-4 focus:border-green-500 outline-none transition text-white">
                            </div>
                        </div>

                        <div class="pt-4">
                            <button type="submit" id="loginBtn" class="w-full bg-green-600 hover:bg-green-500 text-white py-4 rounded-2xl font-bold text-lg transition-all transform hover:scale-[1.02] active:scale-95 shadow-xl shadow-green-900/20 flex items-center justify-center gap-3">
                                <span>Sign In</span>
                                <i data-lucide="log-in" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </form>

                    <div class="mt-8 pt-8 border-t border-slate-800 text-center">
                        <p class="text-slate-400 text-sm">
                            New to XMONIE? 
                            <a href="register.html" class="text-green-500 font-bold hover:underline ml-1">Create an account</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Error Toast -->
    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-red-600 text-white px-8 py-4 rounded-2xl shadow-2xl opacity-0 transition-all duration-300 z-[110] pointer-events-none text-sm font-bold"></div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby5ghdEo-OsjoK0tmyZYF6T7BC8K5fl5gtGulaXefMswODFOv0A5rpQ6VHp3P4U_Enh/exec'; // Paste your Deployed Apps Script URL here

        lucide.createIcons();
        const form = document.getElementById('loginForm');
        const loginBtn = document.getElementById('loginBtn');
        const toast = document.getElementById('toast');

        function showToast(msg) {
            toast.innerText = msg;
            toast.classList.remove('opacity-0', 'translate-y-4');
            toast.classList.add('opacity-100', '-translate-y-0');
            setTimeout(() => {
                toast.classList.remove('opacity-100', '-translate-y-0');
                toast.classList.add('opacity-0', 'translate-y-4');
            }, 4000);
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!SCRIPT_URL) {
                showToast("Developer Error: SCRIPT_URL is empty.");
                return;
            }

            loginBtn.disabled = true;
            loginBtn.innerHTML = `<span class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></span> Authenticating...`;

            const formData = new FormData(form);
            const data = Object.fromEntries(formData);

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'login', data: data })
                });

                const result = await response.json();

                if (result.status === 'success') {
                    // STORE SESSION
                    localStorage.setItem('XMONIE', JSON.stringify({
                        token: btoa(result.user.email), // Basic obfuscation
                        user: result.user,
                        loginTimestamp: Date.now()
                    }));
                    
                    // Redirect to Dashboard
                    window.location.href = 'dashboard.html';
                } else {
                    showToast(result.message || "Login failed. Check your credentials.");
                    loginBtn.disabled = false;
                    loginBtn.innerHTML = `<span>Sign In</span><i data-lucide="log-in" class="w-5 h-5"></i>`;
                    lucide.createIcons();
                }
            } catch (err) {
                showToast("Server Error. Check your internet connection.");
                loginBtn.disabled = false;
                loginBtn.innerHTML = `<span>Sign In</span><i data-lucide="log-in" class="w-5 h-5"></i>`;
                lucide.createIcons();
            }
        });

        // Clear existing session on login page load to prevent conflicts
        localStorage.removeItem('XMONIE');
    </script>
</body>
</html>